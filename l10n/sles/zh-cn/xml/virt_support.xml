<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="virt_support.xml" version="5.0" xml:id="cha-virt-support">
 <title>支持的主机、Guest 和功能</title>
 <info>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:bugtracker/>
        <dm:translation>是</dm:translation>
      </dm:docmanager>
    </info>
    <para os="sles;sled">
  <link xlink:href="https://www.suse.com/releasenotes/">《Release Notes》（发行说明）</link>中概述了支持的体系结构以及 Xen 和 KVM 的虚拟化限制。
 </para>
 <sect1 xml:id="virt-support-hosts">
  <title>主机环境（超级管理程序）</title>

  <para>
   本节列出了在各种虚拟化主机（<xref linkend="gloss-vt-hypervisor"/>）上作为 Guest 运行的 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> <phrase role="productnumber"><phrase os="sles;sled">15 SP2</phrase></phrase> 的支持状态。
  </para>

  <itemizedlist>
   <title>支持以下 SUSE 主机环境 (Xen + KVM)：</title>
   <listitem>
    <para>
     SLES 11 SP4
    </para>
   </listitem>
   <listitem>
    <para>
     SLES 12 SP1、SP2、SP3、SP4、SP5
    </para>
   </listitem>
   <listitem>
    <para>
     SLES 15 SP0、SP1、SP2
    </para>
   </listitem>
  </itemizedlist>

  <itemizedlist>
   <title>支持以下第三方主机环境：</title>
   <listitem>
    <para>
     VMware ESXi 6.5、6.7
    </para>
   </listitem>
   <listitem>
    <para>
     Microsoft Windows 2008 R2 SP1+、2012+、2012 R2+、2016、2019
    </para>
   </listitem>
   <listitem>
    <para>
     Citrix XenServer 7.0、7.1、8.0
    </para>
   </listitem>
   <listitem>
    <para>
     Oracle VM 3.4
    </para>
   </listitem>
  </itemizedlist>

  <itemizedlist>
   <title>支持级别如下：</title>
   <listitem>
    <para>
     对于 Guest 和主机，SUSE 主机操作系统的支持级别均为全面 L3。
    </para>
   </listitem>
   <listitem>
    <para>
     对于 Guest，第三方主机环境的支持级别为全面 L3；对于主机，需要主机供应商的协作与支持。
    </para>
   </listitem>
  </itemizedlist>

  <note>
   <title>对第三方虚拟化主机的支持</title>
   <para>
    仅当虚拟化主机和 Guest 都使用 SUSE 产品时，SUSE 才提供全面 L3 支持。
   </para>
   <para>
    如果虚拟化主机使用第三方软件，则 SUSE 只能保证为 Guest 提供 L3 支持。对于主机，需要供应商的协作。
   </para>
  </note>
 </sect1>
 <sect1 xml:id="virt-support-guests">
  <title>Guest 环境</title>

  <para>
   本节列出了在 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> <phrase role="productnumber"><phrase os="sles;sled">15 SP2</phrase></phrase> 上虚拟化的各种 Guest 操作系统的支持状态。所有全虚拟化（在下表中以 <quote>FV</quote> 表示）和半虚拟化（在下表中以 <quote>PV</quote> 表示）的 Guest 操作系统均受支持，但存在两种例外情况：对于 Windows，仅支持全虚拟化状态，对于 NetWare 操作系统，仅在 Xen 上支持半虚拟化状态。除非另有说明，否则所有 32 位和 64 位版本的 Guest 操作系统均受支持（请参见“NetWare”）。
  </para>

  <itemizedlist>
   <title>以下 Guest 操作系统受到全面支持 (L3)：</title>
   <listitem>
    <para>
     SLES 10 SP4
    </para>
   </listitem>
   <listitem>
    <para>
     SLES 11 SP3、SP4
    </para>
   </listitem>
   <listitem>
    <para>
     SLES 12 SP0、SP1、SP2、SP3、SP4、SP5
    </para>
   </listitem>
   <listitem>
    <para>
     SLES 15 SP0、SP1、SP2
    </para>
   </listitem>
   <listitem>
    <para>
     OES 11 SP2、2015、2015 SP1、2018、2018 SP1、2018 SP2
    </para>
   </listitem>
   <listitem>
    <para>
     Netware 6.5 SP8（仅限 32 位）
    </para>
   </listitem>
   <listitem>
    <para>
     Windows Server 2008 SP2+、2008 R2 SP1+、2012+、2012 R2+、2016、2019
    </para>
   </listitem>
  </itemizedlist>

  <itemizedlist>
   <title>以技术预览（L2，在合理的情况下提供修复）的形式支持以下 Guest 操作系统：</title>
   <listitem>
    <para>
     SLED 15 SP1
    </para>
   </listitem>
  </itemizedlist>

  <itemizedlist>
   <title>如果客户购买了扩展支持，则以下 Red Hat Guest 操作系统受到全面支持 (L3)，否则会按照尽力而为的原则为其提供支持（L2，在合理的情况下提供修复）：</title>
   <listitem>
    <para>
     RHEL 5.11+、6.9+、7.7+、8.0+
    </para>
   </listitem>
  </itemizedlist>

  <itemizedlist>
   <title>按照尽力而为的原则为以下 Guest 操作系统提供支持（L2，在合理的情况下提供修复）：</title>
   <listitem>
    <para>
     Windows 8+、8.1+、10+
    </para>
   </listitem>
  </itemizedlist>

  <sect2 xml:id="sec-kvm-requires-guests-virt-drivers">
   <title>半虚拟化驱动程序的提供</title>
   <para>
    为了提升 Guest 操作系统的性能，我们将会提供半虚拟化驱动程序（如果有）。尽管这些驱动程序不是必需的，但我们强烈建议使用。半虚拟化驱动程序的提供方式如下：
   </para>
   <variablelist>
    
    <varlistentry>
     <term>SUSE Linux Enterprise Server 12/12 SP1/12 SP2</term>
     <listitem>
      <para>
       包含在内核中
      </para>
     </listitem>
    </varlistentry>
    <varlistentry os="sles;sled">
     <term>SUSE Linux Enterprise Server 11/11 SP1/11 SP2/11 SP3/11 SP4</term>
     <listitem>
      <para>
       包含在内核中
      </para>
     </listitem>
    </varlistentry>
    <varlistentry os="sles;sled">
     <term>SUSE Linux Enterprise Server 10SP4</term>
     <listitem>
      <para>
       包含在内核中
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>RedHat</term>
     <listitem>
      <para>
       在 RedHat Enterprise Linux 5.4 和更高版本中提供
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Windows</term>
     <listitem>
      <para>
       SUSE 开发了适用于 Windows 的基于 virtio 的驱动程序，这些驱动程序包含在虚拟机驱动程序包 (VMDP) 中。有关更多信息，请参见<link xlink:href="https://www.suse.com/products/vmdriverpack/"/>。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>
 </sect1>

 <sect1 xml:id="sec-kvm-requires-hardware">
  <title>KVM 硬件要求</title>

  <para>
   目前，SUSE 支持 AMD64/Intel 64 和 Arm AArch64 主机以及 IBM Z 上的 KVM 全虚拟化。
  </para>

  <itemizedlist>
   <listitem>
    <para>
     在 AMD64/Intel 64 体系结构上，KVM 是围绕 AMD* (AMD-V) 和 Intel* (VT-x) CPU 中包含的硬件虚拟化功能设计的。它支持芯片组和 PCI 设备的虚拟化功能，例如 I/O 内存映射单元 (<xref linkend="gloss-vt-acronym-iommu"/>) 和单根 I/O 虚拟化 (<xref linkend="vt-io-sriov"/>)。您可以使用以下命令测试您的 CPU 是否支持硬件虚拟化：
    </para>
<screen><prompt>tux &gt; </prompt>egrep '(vmx|svm)' /proc/cpuinfo</screen>
    <para>
     如果此命令未返回任何输出，则表示您的处理器不支持硬件虚拟化，或者已在 BIOS 或固件中禁用此功能。
    </para>
    <para>
     以下网站指出了支持硬件虚拟化的 AMD64/Intel 64 处理器：<link xlink:href="http://ark.intel.com/Products/VirtualizationTechnology"/>（针对 Intel CPU），以及 <link xlink:href="http://products.amd.com/"/>（针对 AMD CPU）。
    </para>
   </listitem>
   <listitem>
    <para>
     在 Arm 体系结构上，最初是从 Arm Cortex-A15 开始向 Armv7-A 处理器添加虚拟化支持的，其中包括 Cortex-A7 和 Cortex-A17。Armv8-A 处理器包含虚拟化支持。
    </para>
   </listitem>
  </itemizedlist>

  <note>
   <title>不装载 KVM 内核模块</title>
   <para>
    仅当 CPU 硬件虚拟化功能可用时，才会装载 KVM 内核模块。
   </para>
  </note>

  <para>
   VM 主机服务器的一般性最低硬件要求与<phrase os="sles"><xref linkend="sec-x86-requirements"/>中概述的相同。</phrase>不过，对于每个虚拟化的 Guest 都需要提供额外的 RAM。此额外 RAM 量应至少与物理安装所需的 RAM 量相同。另外，强烈建议为每个运行中的 Guest 至少配备一个处理器核心或超线程。
  </para>
 </sect1>
 <sect1 xml:id="virt-support-feature-support">
  <title>功能支持</title>

  <para/>

  <sect2 xml:id="virt-support-feature-support-host">
   <title>主机 (Dom0)</title>
   <table>
    <title>功能支持 — 主机 (<literal>Dom0</literal>)</title>
    <tgroup cols="2">
     <colspec colnum="1" colname="1" colwidth=""/>
     <colspec colnum="2" colname="2" colwidth="80"/>
     <thead>
      <row>
       <entry>
        <para>
         功能
        </para>
       </entry>
       <entry>
        <para>
         Xen
        </para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row>
       <entry>
        <para>
         网络和块设备热插拔
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         物理 <xref linkend="gloss-vt-cpu-hotplug"/>
        </para>
       </entry>
       <entry>
        <para>
         否
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         虚拟 <xref linkend="gloss-vt-cpu-hotplug"/>
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         虚拟 <xref linkend="gloss-vt-cpu-pinning"/>
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         虚拟 <xref linkend="gloss-vt-cpu-capping"/>
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         Intel* VT-x2：FlexPriority、FlexMigrate（迁移限制适用于不同的 CPU 体系结构）
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         Intel* VT-d2（具有中断过滤和排队失效的 DMA 重新映射）
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         AMD* IOMMU（具有 Guest 到主机物理地址转换的 I/O 页表）
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>



   <note>
    <title>不支持在运行时添加或去除物理 CPU</title>
    <para>
     不支持在运行时添加或去除物理 CPU，但可以添加或去除每个 VM Guest 的虚拟 CPU。
    </para>
   </note>
  </sect2>

  <sect2 xml:id="virt-support-feature-support-pv">
   <title>半虚拟化 Guest</title>
   <table>
    <title>功能支持 — 半虚拟化 Guest</title>
    <tgroup cols="2">
     <colspec colnum="1" colname="1" colwidth=""/>
     <colspec colnum="2" colname="2" colwidth=""/>
     <thead>
      <row>
       <entry>
        <para>
         功能
        </para>
       </entry>
       <entry>
        <para>
         Xen
        </para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row>
       <entry>
        <para>
         虚拟网络和虚拟块设备热插拔
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         虚拟 <xref linkend="gloss-vt-cpu-hotplug"/>
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         虚拟 <xref linkend="gloss-vt-cpu-overcommit"/>
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         动态虚拟内存大小调整
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         VM 保存和恢复
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         VM 实时迁移
        </para>
       </entry>
       <entry>
        <para>
         是，在具有类似资源的类似虚拟主机系统之间
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         使用 GDBC 进行高级调试
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         对 VM 可见的 Dom0 度量
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         内存气球
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         PCI 直通
        </para>
       </entry>
       <entry>
        <para>
         是（不包括 Netware Guest）
        </para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
   <para>
    对于实时迁移，源体系结构和目标体系结构均需要匹配；即处理器（AMD* 或 Intel*）必须相同。除非使用了 CPU ID 掩码（例如，使用 Intel FlexMigration），否则目标的处理器修订版应该与源相同或者比源更新。如果在不同系统之间移动 VM，那么这些规则适用于每一次移动。为了避免优化的代码在运行时或应用程序启动期间失败，源 CPU 和目标 CPU 需要公开相同的处理器扩展。Xen 透明地向 VM 公开物理 CPU 扩展。总而言之，Guest 可以是 32 位或 64 位，但 <xref linkend="gloss-vt-vhs"/> 必须相同。
   </para>
   <note>
    <title>Intel FlexMigration</title>
    <para>
     对于支持 Intel FlexMigration 的计算机，CPU-ID 掩码和错误引发可以提高跨 CPU 迁移的灵活性。
    </para>
   </note>
  </sect2>

  <sect2 xml:id="virt-support-feature-support-fv">
   <title>全虚拟化 Guest</title>
   <table>
    <title>功能支持 — 全虚拟化 Guest</title>
    <tgroup cols="3">
     <colspec colwidth=""/>
     <colspec colwidth=""/>
     <thead>
      <row>
       <entry>
        <para>
         功能
        </para>
       </entry>
       <entry>
        <para>
         Xen
        </para>
       </entry>
       <entry>
        <para>
         KVM
        </para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row>
       <entry>
        <para>
         虚拟网络和虚拟块设备热插拔
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         虚拟 <xref linkend="gloss-vt-cpu-hotplug"/>
        </para>
       </entry>
       <entry>
        <para>
         否
        </para>
       </entry>
       <entry>
        <para>
         否
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         虚拟 <xref linkend="gloss-vt-cpu-overcommit"/>
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         动态虚拟内存大小调整
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         VM 保存和恢复
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         VM 实时迁移
        </para>
       </entry>
       <entry>
        <para>
         是，在具有类似资源的类似虚拟主机系统之间（即，从 32 位迁移到 32 位，或从 64 位迁移到 64 位）
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         VM 快照
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         使用 GDBC 进行高级调试
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         对 VM 可见的 Dom0 度量
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         PCI 直通
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
   <note>
    <title>Windows Guest</title>
    <para>
     仅当使用的是 PV 驱动程序 (VMDP) 时，才支持在 Xen 和 KVM 中热插拔虚拟网络和虚拟块设备，以及收缩、恢复动态虚拟内存及调整其大小。
    </para>
   </note>
   <para>
    对于 KVM，有关支持的限制、功能、建议的设置和方案的详细说明以及其他有用信息均在 <filename>kvm-supported.txt</filename> 中提供。此文件是 KVM 软件包的一部分，可在 <filename>/usr/share/doc/packages/kvm</filename> 中找到。
   </para>
  </sect2>
 </sect1>


</chapter>
