<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="containers-get.xml" version="5.0" xml:id="cha-containers-get">
 <info>
      <title>获取容器</title>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:translation>是</dm:translation>
      </dm:docmanager>
    </info>
    <para>
  本章提供获取容器映像的相关信息。
 </para>
 <sect1 xml:id="id-sle-base-images">
  <title>SUSE Linux Enterprise 基本映像</title>

  <para>
   SUSE 提供了大量官方基本容器映像，您可以基于这些映像来构建自定义容器。每个 SLE 基本映像都包含一个不带内核的 SLE 版本。基本映像中包含的操作系统是不具有任何功能的空环境。
  </para>

  <para>
   您可从 <link xlink:href="https://registry.suse.com"/> 获取基本映像。有关 SUSE 注册表的信息，请参见<xref linkend="suse-registry"/>。SUSE 注册表中的映像均为正式发布（生产）的版本以及 SLES 12 和 SLES 15 的 <link xlink:href="https://www.suse.com/products/long-term-service-pack-support/">LTSS</link> 版本。SUSE 注册表中的 SUSE Linux Enterprise 基本映像可接收安全更新，并涵盖在 SUSE 支持计划中。有关这些支持计划的详细信息，请参见<xref linkend="cha-containers-support"/>。
  </para>
 </sect1>
 <sect1 xml:id="id-suse-container-properties">
  <title>SUSE 容器属性</title>

  <para>
   SUSE 容器映像带有标识符，可帮助您选择满足您需求的适合映像。从储存库中提取容器映像并在其上运行 <literal>podman inspect</literal> 之后，便可访问下面列出的各个标识符。
  </para>

  <sect2 xml:id="id-repository-names">
   <title>储存库名称</title>
   <para>
    储存库名称以产品名称开头，例如：<literal>suse/sle/(…​)</literal>、<literal>opensuse/tumbleweed/(…​)</literal>、<literal>caasp/(…​)</literal>。适用于所有服务包的 SLE 15 容器位于名称空间 <literal>suse/sle15</literal> 中。此规则也适用于 SLE 的未来版本（例如 <literal>suse/sle16</literal>）。但对于 SLE 12 而言，每个服务包都有一个独立的储存库名称，例如 <literal>suse/sle12sp3</literal>、<literal>suse/sle12sp4</literal>、<literal>suse/sle12sp5</literal>。
   </para>
  </sect2>

  <sect2 xml:id="id-labels">
   <title>标签</title>
   <para>
    标签有助于识别映像。所有 SLE 容器映像标签均以 <literal>com.suse.&lt;product&gt;.&lt;containername&gt;</literal> 开头，后跟进一步的规范。openSUSE 容器映像可通过以 <literal>org.opencontainers</literal> 开头的标签来识别。
   </para>
   <important>
    <title><literal>com.suse.sle.base</literal> 标签受到保护。</title>
    <para>
     通过将每一层添加到基本映像，可使用派生映像中的标签重写基本容器中定义的标签。为了保护映像来源的相关信息，已将标签 <literal>com.suse.sle.base</literal> 添加到 SLE 容器映像。此标签会指出 SUSE 是相关映像的供应商。由于标签受到保护，它不会被基本映像的任何修改所重写。
    </para>
    <para>
     与之相反，openSUSE 基本映像中的标签则并未受到保护。例如，<literal>org.opencontainers.image.title</literal> 始终包含最后添加层的标题。
    </para>
   </important>
   <para>
    下面是所有当前定义的标签的列表：
   </para>
   <table frame="all" rowsep="1" colsep="1">
    <title>当前定义的标签</title>
    <tgroup cols="5">
     <colspec colname="col_1" colwidth="10*"/>
     <colspec colname="col_2" colwidth="30*"/>
     <colspec colname="col_3" colwidth="18*"/>
     <colspec colname="col_4" colwidth="18*"/>
     <colspec colname="col_5" colwidth="24*"/>
     <thead>
      <row>
       <entry align="left" valign="top">必须由派生映像提供</entry>
       <entry align="left" valign="top">标签</entry>
       <entry align="left" valign="top">OCI 批注</entry>
       <entry align="left" valign="top">说明</entry>
       <entry align="left" valign="top">示例</entry>
      </row>
     </thead>
     <tbody>
      <row>
       <entry align="left" valign="top">
        <para>
         是
        </para>
       </entry>
       <entry align="left" valign="top">
        <para>
         org.​opencontainers.​image.​<emphasis role="strong">title</emphasis> com.​suse.​sle.​base.​<emphasis role="strong">title</emphasis>
        </para>
       </entry>
       <entry align="left" valign="top">
        <para>
         org.​opencontainers.​image.​title
        </para>
       </entry>
       <entry align="left" valign="top">
        <para>
         映像标题
        </para>
       </entry>
       <entry align="left" valign="top">
        <para>
         SUSE Linux Enterprise 15 基本容器
        </para>
       </entry>
      </row>
      <row>
       <entry align="left" valign="top">
        <para>
         是
        </para>
       </entry>
       <entry align="left" valign="top">
        <para>
         org.​opencontainers.​image.​<emphasis role="strong">description</emphasis> com.​suse.​sle.​base.​<emphasis role="strong">description</emphasis>
        </para>
       </entry>
       <entry align="left" valign="top">
        <para>
         org.​opencontainers.​image.​description
        </para>
       </entry>
       <entry align="left" valign="top">
        <para>
         映像的简短说明
        </para>
       </entry>
       <entry align="left" valign="top">
        <para>
         包含基于 SUSE Linux Enterprise 15 的容器最小环境的映像。
        </para>
       </entry>
      </row>
      <row>
       <entry align="left" valign="top">
        <para>
         是
        </para>
       </entry>
       <entry align="left" valign="top">
        <para>
         org.​opencontainers.​image.​<emphasis role="strong">version</emphasis> com.​suse.​sle.​base.​<emphasis role="strong">version</emphasis>
        </para>
       </entry>
       <entry align="left" valign="top">
        <para>
         org.​opencontainers.​image.​version
        </para>
       </entry>
       <entry align="left" valign="top">
        <para>
         映像版本
        </para>
       </entry>
       <entry align="left" valign="top">
        <para>
         &lt;codestream&gt;.&lt;sp&gt;.​&lt;cicnt&gt;.&lt;bldcnt&gt; 15.0.4.2
        </para>
       </entry>
      </row>
      <row>
       <entry align="left" valign="top">
        <para>
         是
        </para>
       </entry>
       <entry align="left" valign="top">
        <para>
         org.​opencontainers.​image.​<emphasis role="strong">created</emphasis> com.​suse.​sle.​base.​<emphasis role="strong">created</emphasis>
        </para>
       </entry>
       <entry align="left" valign="top">
        <para>
         org.​opencontainers.​image.​created
        </para>
       </entry>
       <entry align="left" valign="top">
        <para>
         映像构建的时间戳
        </para>
       </entry>
       <entry align="left" valign="top">
        <para>
         2018-07-27T14:12:30Z
        </para>
       </entry>
      </row>
      <row>
       <entry align="left" valign="top">
        <para>
         否
        </para>
       </entry>
       <entry align="left" valign="top">
        <para>
         org.​opencontainers.​image.​<emphasis role="strong">vendor</emphasis> com.​suse.​sle.​base.​<emphasis role="strong">vendor</emphasis>
        </para>
       </entry>
       <entry align="left" valign="top">
        <para>
         org.​opencontainers.​image.​vendor
        </para>
       </entry>
       <entry align="left" valign="top">
        <para>
         映像供应商
        </para>
       </entry>
       <entry align="left" valign="top">
        <para>
         SUSE LLC
        </para>
       </entry>
      </row>
      <row>
       <entry align="left" valign="top">
        <para>
         否
        </para>
       </entry>
       <entry align="left" valign="top">
        <para>
         org.​opencontainers.​image.​<emphasis role="strong">url</emphasis> com.​suse.​sle.​base.​<emphasis role="strong">url</emphasis>
        </para>
       </entry>
       <entry align="left" valign="top">
        <para>
         org.​opencontainers.​image.​url
        </para>
       </entry>
       <entry align="left" valign="top">
        <para>
         更多信息
        </para>
       </entry>
       <entry align="left" valign="top">
        <para>
         <link xlink:href="https://www.suse.com/products/server/"/>
        </para>
       </entry>
      </row>
      <row>
       <entry align="left" valign="top">
        <para>
         是
        </para>
       </entry>
       <entry align="left" valign="top">
        <para>
         org.​openbuildservice.​<emphasis role="strong">disturl</emphasis> com.​suse.​sle.​base.​<emphasis role="strong">disturl</emphasis>
        </para>
       </entry>
       <entry align="left" valign="top">
        <para>
         org.​openbuildservice.​disturl
        </para>
       </entry>
       <entry align="left" valign="top">
        <para>
         映像 OBS URL
        </para>
       </entry>
       <entry align="left" valign="top">
        <para>
         obs://build.suse.de/SUSE:SLE-15:​Update:CR/images/2951b67133​dd6384cacb2820317​4e030-sles15-image
        </para>
       </entry>
      </row>
      <row>
       <entry align="left" valign="top">
        <para>
         是
        </para>
       </entry>
       <entry align="left" valign="top">
        <para>
         org.​opensuse.​<emphasis role="strong">reference</emphasis> com.​suse.​sle.​base.​<emphasis role="strong">reference</emphasis>
        </para>
       </entry>
       <entry align="left" valign="top">
        <para>
         org.​opensuse.​reference
        </para>
       </entry>
       <entry align="left" valign="top">
        <para>
         指向此特定映像的参考。不得更改您使用 docker pull &lt;ref.name&gt; 命令获取的映像。
        </para>
       </entry>
       <entry align="left" valign="top">
        <para>
         registry.suse.com/suse/sle15:4.2
        </para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
  </sect2>

  <sect2 xml:id="id-tags">
   <title>标记</title>
   <para>
    标记用于添加阐述性信息。与标签不同，标记可以自由定义。标记通常包含容器映像特定版本的相关信息。
   </para>
   <para>
    如果某个标记存在于多个映像中，则将使用最新的映像。由映像维护者决定指派给容器映像的标记。
   </para>
   <para>
    常规标记格式为：<literal>储存库名称</literal>: <literal>映像版本规范</literal>（通常为版本号）。例如，<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 15 SP1 的最新发布映像的标记将为 <literal>suse/sle15:15.1</literal>。
   </para>
   <para>
    下表显示在 <literal>registry.suse.com</literal> 上找到的示例 SLE 容器映像标记。其中一些标记会定期更新，因此它们不会批注确切的映像版本，而是会充当占位符。定期更新的标记以粗体标示。
   </para>
   <table frame="all" rowsep="1" colsep="1">
    <title>当前使用的标记示例</title>
    <tgroup cols="2">
     <colspec colname="col_1" colwidth="50*"/>
     <colspec colname="col_2" colwidth="50*"/>
     <tbody>
      <row>
       <entry align="left" valign="top">
        <para>
         储存库名称：Tag
        </para>
       </entry>
       <entry align="left" valign="top">
        <para>
         说明
        </para>
       </entry>
      </row>
      <row>
       <entry align="left" valign="top">
        <para>
         suse/sle12sp3: <emphasis role="strong">latest</emphasis>
        </para>
       </entry>
       <entry align="left" valign="top">
        <para>
         SUSE Linux Enterprise 12 SP3 的最新发布映像。
        </para>
       </entry>
      </row>
      <row>
       <entry align="left" valign="top">
        <para>
         suse/sle12sp3: <emphasis role="strong">2.0.2</emphasis>
        </para>
       </entry>
       <entry align="left" valign="top">
        <para>
         与 <literal>latest</literal> 相同。仅为向后兼容而保留。
        </para>
       </entry>
      </row>
      <row>
       <entry align="left" valign="top">
        <para>
         suse/sle15: <emphasis role="strong">latest</emphasis>
        </para>
       </entry>
       <entry align="left" valign="top">
        <para>
         SUSE Linux Enterprise 15 编码流的最新发布映像。在本例中，与 15.1 和 15.1.1.1 相同。
        </para>
       </entry>
      </row>
      <row>
       <entry align="left" valign="top">
        <para>
         suse/sle15: <emphasis role="strong">15.1</emphasis>
        </para>
       </entry>
       <entry align="left" valign="top">
        <para>
         SLE 15 SP1 的最新发布映像。
        </para>
       </entry>
      </row>
      <row>
       <entry align="left" valign="top">
        <para>
         suse/sle15: 15.1.1.1
        </para>
       </entry>
       <entry align="left" valign="top">
        <para>
         与 15.1.1.0 相同，但包含一些更新的软件包。
        </para>
       </entry>
      </row>
      <row>
       <entry align="left" valign="top">
        <para>
         suse/sle15: 15.1.1.0
        </para>
       </entry>
       <entry align="left" valign="top">
        <para>
         第一个 SUSE Linux Enterprise 15 SP1 映像。
        </para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
  </sect2>
 </sect1>
 <sect1 xml:id="suse-registry">
  <title>SUSE 注册表</title>

  <para>
   官方 SUSE 注册表可从 <link xlink:href="https://registry.suse.com"/> 获取。它包含经过测试和更新的 SUSE Linux Enterprise 和 SLES 基本容器映像。SUSE 注册表中的所有映像都要经历一个固定的维护过程。使用最新的安全修复定期更新映像。SUSE 注册表可以免费使用，同时还提供有额外功能，可通过在容器主机上的客户订阅获得这些功能。需要订阅容器映像才能收到更新。当前，SUSE 注册表没有 UI 或映像列表。但在<xref linkend="Building-Pre-build-Images"/>的示例中列出了所有可用映像。
  </para>
 </sect1>
 <sect1 xml:id="comparing-containers">
  <title>比较容器</title>

  <para>
   <link xlink:href="https://github.com/GoogleContainerTools/container-diff#container-diff">container-diff</link> 工具可用于分析和比较容器映像。<literal>container-diff</literal> 可根据多个不同准则检查映像，其中包括：
  </para>

  <itemizedlist>
   <listitem>
    <para>
     Docker 映像历史
    </para>
   </listitem>
   <listitem>
    <para>
     映像文件系统
    </para>
   </listitem>
   <listitem>
    <para>
     DEB 软件包
    </para>
   </listitem>
   <listitem>
    <para>
     RPM 软件包
    </para>
   </listitem>
   <listitem>
    <para>
     PyPI 软件包
    </para>
   </listitem>
   <listitem>
    <para>
     NPM 软件包
    </para>
   </listitem>
  </itemizedlist>

  <para>
   您可以检查单个映像，也可以在两个映像上执行 diff 操作。<literal>container-diff</literal> 支持位于本地 Docker 守护程序和远程注册表中的 Docker 映像。还可以结合 <filename>.tar</filename>、<filename>.tar.gz</filename> 和 <filename>.tgz</filename> 存档使用工具。
  </para>

  <para>
   另一方面， <package>container-diff</package> 软件包属于 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> <phrase role="productnumber"><phrase os="sles;sled">15 SP2</phrase></phrase> Containers Module 的一部分。您也可以单独安装该软件包。有关安装该软件包的说明，请参见 <link xlink:href="https://github.com/GoogleContainerTools/container-diff#installation">container-diff 文档</link>。
  </para>
 </sect1>
 <sect1 xml:id="id-on-premise-registry">
  <title>本地注册表</title>

  <sect2 xml:id="id-portus">
   <title>Portus</title>
   <para>
    <link xlink:href="http://port.us.org/">Portus</link> 是一种本地应用程序，可为 Docker 注册表提供图形界面和授权机制。有关 Portus 功能的详细说明，请参见 <link xlink:href="http://port.us.org/features.html"/>。
   </para>
   <para>
    您可以使用标准 Docker 容器在 Kubernetes 群集内或在裸机上部署 Portus。有关部署选项以及如何在开发环境中开始使用 Portus 的说明，请参见 <link xlink:href="http://port.us.org/docs/deploy.html"/>。
   </para>
   <para>
    有关如何通过 SUSE 容器注册表安装 Portus 的说明，请参见<xref linkend="sec-docker-portus"/>。
   </para>
  </sect2>
 </sect1>
</chapter>
