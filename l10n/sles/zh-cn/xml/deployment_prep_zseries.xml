<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="deployment_prep_zseries.xml" version="5.0" xml:id="cha-zseries">
 <title>在 IBM z Systems 上安装</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
  <abstract>
   <para>
    本章介绍了在 IBM z Systems 上安装 <phrase role="productname"><phrase os="sles">SUSE® Linux Enterprise Server</phrase></phrase> 的准备程序。它提供了准备在 LPAR 和 z/VM 终端上进行安装所需的所有信息。
   </para>
  </abstract>
 </info>
 <xi:include href="deployment_prep_zseries_info_i.xml"/>
 <xi:include href="deployment_prep_zseries_prep_i.xml"/>
 <sect1 xml:id="sec-appdendix-parm">
  <title>parmfile — 自动进行系统配置</title>

  <para>
   通过在 <filename>parmfile</filename> 中指定一些关键参数，可以部分自动化安装过程。<filename>parmfile</filename> 包含网络设置和 DASD 配置所需的所有数据。除此之外，它还可用于设置与 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 安装系统及其上运行的 YaST 实例建立连接的方法。这样，就把用户的交互限制成由 YaST 对话框控制的实际的 YaST 安装。
  </para>

  <para>
   以下参数可以传递到安装例程，该安装例程将这些参数作为安装的默认值。所有 IP 地址、服务器名和数值仅为示例。用安装方案中需要的值替换这些值。
  </para>

  <para>
   parmfile 中的行数限制为 10 行。请在一行上指定多个参数。参数名是不区分大小写的。用空格分隔参数。您可以按任何顺序指定参数。请始终在一行上保持 <literal>PARAMETER=value</literal> 字符串。例如：
  </para>

<screen>Hostname=s390zvm01.suse.de HostIP=10.11.134.65</screen>

  <tip>
   <title>在安装期间使用 IPv6</title>
   <para>
    默认情况下，仅可为您的计算机指定 IPv4 网络地址。要在安装期间启用 IPv6，请在引导提示处输入以下参数之一：<literal>ipv6=1</literal>（接受 IPv4 和 IPv6），<literal>ipv6only=1</literal>（仅接受 IPv6）。
   </para>
  </tip>

  <para>
   需要以下某些参数。如果缺少它们，则会暂停自动处理并要求您手动输入值。
  </para>

  <sect2 xml:id="sec-appdendix-parm-general">
   <title>一般参数</title>
   <variablelist>
    <varlistentry>
     <term><command>AutoYaST=</command><replaceable>&lt;URL&gt;</replaceable> <command>Manual=0</command>
     </term>
     <listitem>
      <para>
       <envar>AutoYaST</envar> 参数为自动安装指定 <filename>autoinst.xml</filename> 控制文件的位置。<envar>Manual</envar> 参数控制其他参数是否仅仅是用户必须确认的默认值。如果要接受所有值并且没有任何问题，则将此参数设置成 <literal>0</literal>。设置 <envar>AutoYaST</envar> 隐含设置 <envar>Manual</envar> 为 <literal>0</literal>。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>Info=</command><replaceable>&lt;URL&gt;</replaceable>
     </term>
     <listitem>
      <para>
       指定文件的位置，该文件用于读取其他选项。这可以帮助克服 parm 文件的 10 行限制（以及在 z/VM 下每行 80 个字符的限制）。有关 Info 文件的更多文档，可以在<xref linkend="invoking-autoinst-linuxrc"/>中找到。由于 Info 文件通常只能从 z Systems 上通过网络访问，因此不能使用它指定设置网络所需的选项（即<xref linkend="sec-appdendix-parm-net"/>中所述的选项）。此外，其他特定于 linuxrc 的选项（例如用于调试的选项）需要在 parmfile 中指定才能生效。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>Upgrade=&lt;0|1&gt;</command></term>
     <listitem>
      <para>要升级 SUSE Linux Enterprise，请指定 <command>Upgrade=1</command>。因此，需要自定义 parmfile 才能升级现有的 SUSE Linux Enterprise 安装。如果未设置此参数，安装将不会提供任何升级选项。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>

  <sect2 xml:id="sec-appdendix-parm-net">
   <title>配置网络接口</title>
   <important>
    <title>配置网络接口</title>
    <para>
     本节中讨论的设置仅应用于安装过程中使用的网络接口。遵循<xref linkend="sec-basicnet-manconf"/>中提供的说明，配置已安装系统中的其他网络接口。
    </para>
   </important>
   <variablelist>
    <varlistentry>
     <term><command>Hostname=zsystems.example.com</command>
     </term>
     <listitem>
      <para>
       输入完全限定的主机名。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>Domain=example.com</command>
     </term>
     <listitem>
      <para>
       DNS 的域搜索路径。允许您使用短主机名来替代全限定主机名。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>HostIP=192.168.1.2</command>
     </term>
     <listitem>
      <para>
       输入要配置接口的 IP 地址。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>Gateway=192.168.1.3</command>
     </term>
     <listitem>
      <para>
       指定要使用的网关。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>Nameserver=192.168.1.4</command>
     </term>
     <listitem>
      <para>
       指定负责的 DNS 服务器。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>InstNetDev=osa</command>
     </term>
     <listitem>
      <para>
       输入要配置的接口类型。可能的值为 <literal>osa</literal>、<literal>hsi</literal>、<literal>ctc</literal>、<literal>escon</literal> 和 <literal>iucv</literal>（不再正式支持 CTC、ESCON 和 IUCV）。
      </para>
      <para>
       对于类型为 <literal>hsi</literal> 和 <literal>osa</literal> 的接口，指定相应的掩码和可选的广播地址：
      </para>
<screen>Netmask=255.255.255.0
Broadcast=192.168.255.255</screen>
      <para>
       对于类型为 <literal>ctc</literal>、<literal>escon</literal> 和 <literal>iucv</literal>（不再正式支持 CTC、ESCON 和 IUCV）的接口，输入对等的 IP 地址：
      </para>
<screen>Pointopoint=192.168.55.20</screen>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>OsaInterface=&lt;lcs|qdio&gt;</command>
     </term>
     <listitem>
      <para>
       对于 <literal>osa</literal> 网络设备，请指定主机接口（<literal>qdio</literal> 或 <literal>lcs</literal>）。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>Layer2=&lt;0|1&gt;</command>
     </term>
     <listitem>
      <para>
       对于 <literal>osa</literal> QDIO 以太网和 <literal>hsi</literal> 设备，请指定是要启用 (<literal>1</literal>) 还是禁用 (<literal>0</literal>) OSI 第 2 层支持。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>OSAHWAddr=02:00:65:00:01:09</command>
     </term>
     <listitem>
      <para>
       适用于已启用第 2 层的 <literal>osa</literal> QDIO 以太网设备。手动指定一个 MAC 地址，或者为系统默认值指定 <literal>OSAHWADDR= </literal>（以空格结尾）。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>PortNo=&lt;0|1&gt;</command>
     </term>
     <listitem>
      <para>
       对于 <literal>osa</literal> 网络设备，指定端口号（如果设备支持此功能）。默认值是 0。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    每个接口都需要特定的设置选项：
   </para>
   <itemizedlist>
    <listitem>
     <para>
      接口 <literal>ctc</literal> 和 <literal>escon</literal>（不再正式支持 CTC 和 ESCON）：
     </para>
<screen>ReadChannel=0.0.0600
WriteChannel=0.0.0601</screen>
     <para>
      <envar>ReadChannel</envar> 指定要使用的 READ 通道。<envar>WriteChannel</envar> 指定 WRITE 通道。
     </para>
    </listitem>
    <listitem>
     <para>
      对于 <literal>ctc</literal> 接口（不再正式支持），指定应该用于此接口的协议：
     </para>
<screen>CTCProtocol=&lt;0/1/2&gt;</screen>
     <para>
      有效的输入值是：
     </para>
     <informaltable>
      <tgroup cols="2">
       <tbody>
        <row>
         <entry>
          <para>
           <literal>0</literal>
          </para>
         </entry>
         <entry>
          <para>
           兼容模式，也用于除 OS/390 和 z/OS 之外的非 Linux 的对等操作系统（这是默认模式）
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           <literal>1</literal>
          </para>
         </entry>
         <entry>
          <para>
           扩展方式
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           <literal>2</literal>
          </para>
         </entry>
         <entry>
          <para>
           与 OS/390 和 z/OS 的兼容性方式"
          </para>
         </entry>
        </row>
       </tbody>
      </tgroup>
     </informaltable>
    </listitem>
    <listitem>
     <para>
      网络设备类型 <literal>osa</literal>，接口为 <literal>lcs</literal>：
     </para>
<screen>ReadChannel=0.0.0124</screen>
     <para>
      <envar>ReadChannel</envar> 代表此安装中使用的通道号。将一个号添加到 <envar>ReadChannel</envar> 就可以从中获得第二个端口号。<envar>Portnumber</envar> 用于指定相对端口。
     </para>
    </listitem>
    <listitem>
     <para>
      接口 <literal>iucv</literal>：
     </para>
<screen>IUCVPeer=PEER</screen>
     <para>
      输入每台对等机器的名称。
     </para>
    </listitem>
    <listitem>
     <para>
      用于 OSA-Express 千兆以太网的网络设备类型为 <literal>osa</literal>，其接口为 <literal>qdio</literal>：
     </para>
<screen>ReadChannel=0.0.0700
WriteChannel=0.0.0701
DataChannel=0.0.0702</screen>
     <para>
      对于 <envar>ReadChannel</envar>，输入 READ 通道号。对于 <envar>WriteChannel</envar>，输入 WRITE 通道号。<envar>DataChannel</envar> 指定 DATA 通道。确保 READ 通道带有连续的设备号。
     </para>
    </listitem>
    <listitem>
     <para>
      用于 HiperSockets 和 VM guest LAN 的接口 <literal>hsi</literal>：
     </para>
<screen>ReadChannel=0.0.0800
WriteChannel=0.0.0801
DataChannel=0.0.0802</screen>
     <para>
      对于 <envar>ReadChannel</envar>，输入相应的 READ 通道号。对于 <envar>WriteChannel</envar> 和 <envar>DataChannel</envar>，输入 WRITE 和 DATA 通道号。
     </para>
    </listitem>
   </itemizedlist>
  </sect2>

  <sect2 xml:id="sec-appdendix-parm-yast2">
   <title>指定储存库和 YaST 接口</title>
   <variablelist>
    <varlistentry>
     <term><command>Install=nfs://server/directory/DVD1/</command>
     </term>
     <listitem>
      <para>
       指定要使用的储存库的位置。可能的协议有 <literal>nfs</literal>、<literal>smb</literal> (Samba/CIFS)、<literal>ftp</literal>、<literal>tftp</literal>
       <literal>、http</literal> 和 <literal>https</literal>。
      </para>
      <para>
       如果给定了 <literal>ftp</literal>、<literal>tftp</literal> 或 <literal>smb</literal> URL，则指定该 URL 的用户名和口令。这些参数是可选的，如果未给定，则假设为匿名或 guest 登录。
      </para>
<screen>Install=ftp://<replaceable>USER</replaceable>:<replaceable>PASSWORD</replaceable>@<replaceable>SERVER</replaceable>/<replaceable>DIRECTORY</replaceable>/DVD1/
Install=tftp://<replaceable>USER</replaceable>:<replaceable>PASSWORD</replaceable>@<replaceable>SERVER</replaceable>/<replaceable>DIRECTORY</replaceable>/DVD1/</screen>
      <para>
       如果要通过加密连接安装，请使用 <literal>https</literal> URL。如果无法校验证书，请使用 <literal>sslcerts=0</literal> 引导选项禁用证书检查。
      </para>
      <para>
       在 Samba 或 CIFS 安装情况下，您还可以指定要使用的域：
      </para>
<screen>Install=smb://<replaceable>WORKDOMAIN</replaceable>;<replaceable>USER</replaceable>:<replaceable>PASSWORD</replaceable>@<replaceable>SERVER</replaceable>/<replaceable>DIRECTORY</replaceable>/DVD1/</screen>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>ssh=1</command> <command>vnc=1</command> <command>Display_IP=192.168.42.42</command>
     </term>
     <listitem>
      <para>
       据您给定的参数，将为安装使用远程 X 服务器、SSH 或 VNC。<envar>ssh</envar> 支持 SSH 安装，<envar>vnc</envar> 在安装计算机上启动 VNC 服务器，<envar>Display_IP</envar> 会让安装系统尝试连接到位于给定地址的 X 服务器。任何时候仅应该设置其中的一个参数。
      </para>
      <important>
       <title>X 身份验证机制</title>
       <para>
        在 Window 系统直接安装依赖于一个基于主机名的 原始身份验证机制。此机制在当前的 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 版本上已禁用。最好以 SSH 或 VNC 安装。
       </para>
      </important>
      <para>
       要在 YaST 与远程 X 服务器之间建立连接，请运行 <command>xhost</command> <option>&lt;IP 地址&gt;</option>（使用远程计算机上的安装计算机地址）。
      </para>
      <para>
       对于 <literal>VNC</literal>，为安装指定 6 到 8 个字符的口令：
      </para>
<screen>VNCPassword=&lt;a password&gt;</screen>
      <para>
       对于 <literal>SSH</literal>，为安装指定 6 到 8 个字符的口令：
      </para>
<screen>ssh.password=&lt;a password&gt;</screen>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>

  <sect2 xml:id="sec-appdendix-parm-examples">
   <title>示例 parmfile</title>
   <para>
    parmfile 的最大容量为 860 个字符。一般来说，parmfile 最多只应包含 10 行，且每行不超过 79 个字符。读取 parmfile 时，将会串连所有行而不加入空格，因此，每行的最后一个字符 (第 79 个字符) 须为 <keycap function="space"/>。
   </para>
   <para>
    要在控制台上接受潜在的错误消息，请使用
   </para>
<screen>linuxrclog=/dev/console</screen>
   <example xml:id="ex-appdendix-parm-ex1">
    <title>使用 VNC 和 AutoYaST 从 NFS 进行安装的 Parmfile</title>
<screen>ramdisk_size=131072 root=/dev/ram1 ro init=/linuxrc TERM=dumb
instnetdev=osa osainterface=qdio layer2=1 osahwaddr=
pointopoint=192.168.0.1
hostip=192.168.0.2
nameserver=192.168.0.3
install=nfs://192.168.0.4/SLES/SLES-12-Server/s390x/DVD1
autoyast=http://192.168.0.5/autoinst.xml
linuxrclog=/dev/console vnc=1
VNCPassword=testing</screen>
   </example>
   <example xml:id="ex-appdendix-parm-ex2">
    <title>parmfile 安装（对于 NFS、SSH 和 HSI），AutoYaST 安装（对于 NFS）</title>
<screen>ramdisk_size=131072 root=/dev/ram1 ro init=/linuxrc TERM=dumb
AutoYast=nfs://192.168.1.1/autoinst/s390.xml
Hostname=zsystems.example.com HostIP=192.168.1.2
Gateway=192.168.1.3 Nameserver=192.168.1.4
InstNetDev=hsi layer2=0
Netmask=255.255.255.128 Broadcast=192.168.1.255
readchannel=0.0.702c writechannel=0.0.702d datachannel=0.0.702e
install=nfs://192.168.1.5/SLES-12-Server/s390x/DVD1/
ssh=1 ssh.password=testing linuxrclog=/dev/console</screen>
   </example>
  </sect2>
 </sect1>
 <sect1 xml:id="sec-appdendix-vt220">
  <title>使用 vt220 终端仿真器</title>

  <para>
   最新的 MicroCode 级别除了标准行模式终端外，还允许使用集成的 vt220 终端仿真器（ASCII 终端）。vt220 终端连接到 <filename>/dev/ttysclp0</filename>。行模式终端连接到 <filename>/dev/ttysclp_line0</filename>。对于 LPAR 安装，已按默认启动 vt220 终端仿真器。
  </para>

  <para>
   要在 HMC 上启动 ASCII 控制台，请登录 HMC，然后选择<menuchoice> <guimenu>系统管理</guimenu>
   <guimenu> 系统</guimenu>
   <guimenu><phrase><replaceable> 映像 ID</replaceable></phrase>
   </guimenu></menuchoice>。选择 LPAR 对应的单选按钮，然后选择<menuchoice> <guimenu>恢复</guimenu> <guimenu> 集成式 ASCII 控制台</guimenu> </menuchoice>。
  </para>

  <para>
   要将引导时的内核消息从系统控制台重定向到 vt220 终端，请将以下条目添加到 <filename>/etc/zipl.conf</filename> 中的 <literal>parameters</literal> 行：
  </para>

<screen>console=ttysclp0 console=ttysclp_line0</screen>

  <para>
   产生的 <literal>parameters</literal> 行看似如以下示例：
  </para>

<screen>parameters = "root=/dev/dasda2 TERM=dumb console=ttysclp0 console=ttysclp_line0"</screen>

  <para>
   在 <filename>/etc/zipl.conf</filename> 中保存更改，运行 <command>zipl</command> 并重新引导系统。
  </para>
 </sect1>
 <sect1 xml:id="sec-appdendix-further-information">
  <title>有关 IBM z Systems 的更深入信息</title>

  <para>
   IBM Redbooks (<link xlink:href="https://www.redbooks.ibm.com/Redbooks.nsf/domains/zsystems"/>) 或 IBM developerWorks (<link xlink:href="https://www.ibm.com/developerworks/linux/linux390/"/>) 上提供了更多深入的 IBM z Systems 相关技术文档。<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 特定的文档可从 <link xlink:href="https://www.ibm.com/developerworks/linux/linux390/documentation_suse.html"/> 上获取。
  </para>

  <sect2 xml:id="sec-intro-further-information-general">
   <title>有关 Linux on IBM z Systems 的一般文档</title>
   <para>
    以下文档提供了有关 Linux on IBM z Systems 的一般信息：
   </para>
   <itemizedlist>
    <listitem>
     <para>
      Linux on IBM eServer zSeries and S/390: ISP and ASP Solutions (SG24-6299)
     </para>
    </listitem>
   </itemizedlist>
   <para>
    这些文档可能不能反映 Linux 的最新状态，但它们列出的 Linux 部署的准则仍然正确。
   </para>
  </sect2>

  <sect2 xml:id="sec-intro-further-information-technical">
   <title>Linux on IBM z Systems 的技术问题</title>
   <para>
    请参见以下文档，以获得有关 Linux 内核和应用程序主题的详细技术信息。请参见因特网，以了解这些文档有关最新代码发布的最新版本 (<link xlink:href="http://www.ibm.com/developerworks/linux/linux390/index.html"/>)。
   </para>
   <itemizedlist>
    <listitem>
     <para>
      Linux on System z Device Drivers, Features, and Commands
     </para>
    </listitem>
    <listitem>
     <para>
      zSeries ELF Application Binary Interface Supplement
     </para>
    </listitem>
    <listitem>
     <para>
      Linux on System z Device Drivers, Using the Dump Tools
     </para>
    </listitem>
    <listitem>
     <para>
      IBM zEnterprise 196 技术指南
     </para>
    </listitem>
    <listitem>
     <para>
      IBM zEnterprise EC12 技术指南
     </para>
    </listitem>
    <listitem>
     <para>
      IBM z13 技术指南
     </para>
    </listitem>
   </itemizedlist>
   <para>
    <link xlink:href="http://www.redbooks.ibm.com"/> 上也提供了一本有关 Linux 应用程序开发的红皮书：
   </para>
   <itemizedlist>
    <listitem>
     <para>
      Linux on IBM eServer zSeries and S/390: Application Development (SG24-6807)
     </para>
    </listitem>
   </itemizedlist>
  </sect2>

  <sect2 xml:id="sec-info-further-information-advanced">
   <title>Linux on IBM z Systems 的高级配置</title>
   <para>
    请参见以下红皮书、红皮文件和链接，以了解某些更复杂的 IBM z Systems 方案：
   </para>
   <itemizedlist>
    <listitem>
     <para>
      Linux on IBM eServer zSeries and S/390: Large Scale Deployment (SG24-6824)
     </para>
    </listitem>
    <listitem>
     <para>
      Linux on IBM eServer zSeries and S/390: Performance Measuring and Tuning (SG24-6926)
     </para>
    </listitem>
    <listitem>
     <para>
      Linux with zSeries and ESS: Essentials (SG24-7025)
     </para>
    </listitem>
    <listitem>
     <para>
      IBM TotalStorage Enterprise Storage Server Implementing ESS Copy Services with IBM eServer zSeries (SG24-5680)
     </para>
    </listitem>
    <listitem>
     <para>
      Linux on IBM zSeries and S/390: High Availability for z/VM and Linux (REDP-0220)
     </para>
    </listitem>
    <listitem>
     <para>
      Saved Segments Planning and Administration
     </para>
     <para>
      <link xlink:href="http://publibz.boulder.ibm.com/epubs/pdf/hcsg4a00.pdf"/>
     </para>
    </listitem>
    <listitem>
     <para>
      Linux on System z documentation for "Development stream"
     </para>
     <para>
      <link xlink:href="http://www.ibm.com/developerworks/linux/linux390/development_documentation.html"/>
     </para>
    </listitem>
   </itemizedlist>
  </sect2>

  <sect2 xml:id="sec-info-further-information-kvm">
   <title>IBM z Systems 上的 KVM 虚拟化</title>
   <para>
    有关 IBM z Systems 上的 KVM 的详细信息，请参见 <link xlink:href="https://www.ibm.com/developerworks/linux/linux390/documentation_dev.html"/> 中的以下文档：
   </para>
   <itemizedlist>
    <listitem>
     <para>
      《<citetitle>Installing SUSE Linux Enterprise Server 12 as a KVM Guest</citetitle>》（将 SUSE Linux Enterprise Server 12 安装为 KVM Guest）(SC34-2755-00)
     </para>
    </listitem>
    <listitem>
     <para>
      《<citetitle>KVM Virtual Server Quick Start</citetitle>》（KVM 虚拟服务器快速入门）(SC34-2753-01)
     </para>
    </listitem>
    <listitem>
     <para>
      《<citetitle>KVM Virtual Server Management</citetitle>》（KVM 虚拟服务器管理）(SC34-2752-01)
     </para>
    </listitem>
    <listitem>
     <para>
      《<citetitle>Device Drivers, Features, and Commands for Linux as a KVM Guest (Kernel 4.4)</citetitle>》（作为 KVM Guest 的 Linux 的设备驱动程序、功能和命令（内核 4.4））(SC34-2754-01)
     </para>
    </listitem>
   </itemizedlist>
  </sect2>
 </sect1>
</chapter>
