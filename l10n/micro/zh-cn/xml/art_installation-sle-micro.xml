<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet href="urn:x-suse:xslt:profiling:docbook50-profile.xsl"
                 type="text/xml"
                 title="Profiling step"?>
<article xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="art_installation-sle-micro.xml" version="5.0" xml:id="article-installation" xml:lang="zh-cn">
 <title><citetitle>安装快速入门</citetitle></title>
 <subtitle><phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase> <phrase role="productnumber"><phrase os="slemicro">5.0</phrase></phrase></subtitle>
 <info>
  <productnumber><phrase role="productnumber"><phrase os="slemicro">5.0</phrase></phrase></productnumber><productname><phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase></productname>
  <date><?dbtimestamp format="Y"?>
 年 <?dbtimestamp format="B" padding="0"?>
 月 <?dbtimestamp format="d" padding="0"?>
 日
</date>
  <abstract>
   <para>
    此快速入门引导您逐步完成安装 <phrase role="productname"><phrase os="slemicro">SUSE® Linux Enterprise Micro</phrase></phrase> <phrase role="productnumber"><phrase os="slemicro">5.0</phrase></phrase> 的过程。
   </para>
  </abstract>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>是</dm:translation>
  </dm:docmanager>
 </info>
 <sect1 xml:id="sec-slem-installquick">
  <title>欢迎使用 <phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase></title>

  <para>
   <phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase> 是一套主要用于进行边缘计算的现代系统。<phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase> 的主要特性是可预测性和可靠性，这归功于只读根文件系统和事务更新。只读文件系统可确保系统在运行时不能被更改，并且系统在每次重引导后的行为方式相同。事务更新可让您在不影响运行中系统的情况下更新系统，并始终提供回滚。
  </para>

  <para>
   如果您要安装 <phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase>，可以选择以下任一安装过程：
  </para>

  <itemizedlist>
   <listitem>
    <para>
     手动安装，请参见<xref linkend="sec-slem-manual-installation"/>
    </para>
   </listitem>
   <listitem>
    <para>
     使用 AutoYaST 进行无人照管的自动安装，请参见<xref linkend="sec-slem-autoyast"/>
    </para>
   </listitem>
   <listitem>
    <para>
     预构建映像部署，请参见<xref linkend="sec-slem-image-deployment"/>。
    </para>
   </listitem>
  </itemizedlist>
 </sect1>
 <sect1 xml:id="sec-slem-requirements">
  <title><phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase> 硬件要求</title>

  <para>
   <phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase> 的最低硬件要求如下：
  </para>

  <itemizedlist>
   <listitem>
    <para>
     1 GB RAM
    </para>
   </listitem>
   <listitem>
    <para>
     12 GB HDD。
    </para>
   </listitem>
  </itemizedlist>

  <para>
   建议为 SLE Micro 本身分配 20 GB 硬盘空间，为容器数据分配 40 GB 硬盘空间。请记住，实际硬件要求取决于容器的工作负载。
  </para>
 </sect1>
 <sect1 xml:id="sec-slem-manual-installation">
  <title>手动安装过程</title>

  <para>
   以下安装步骤假设您已成功引导到安装系统。
  </para>

  <sect2 xml:id="sec-slem-licence-agreement">
   <title>语言和键盘选择</title>
   <informalfigure>
    <mediaobject>
     <imageobject role="fo">
      <imagedata os="slemicro" fileref="install_language_slem.png" width="100%"/>
     </imageobject>
     <imageobject role="html">
      <imagedata os="slemicro" fileref="install_language_slem.png" width="100%"/>
      </imageobject>
    </mediaobject>
   </informalfigure>
   <para>
    默认语言和键盘布局为英语（美国）。您可以在<guimenu>语言</guimenu>下拉框中选择其他语言。如果需要，您可从<guimenu>键盘布局</guimenu>下拉框中选择其他键盘布局。
   </para>
   <para>
    阅读许可协议。默认语言为英语，不过许可协议有多种语言版本。要获取特定翻译，请单击<guimenu>许可翻译</guimenu>，然后在下拉框中选择所需语言并单击<guimenu>确定</guimenu>。阅读许可协议后，选中<guimenu>我同意许可条款</guimenu>，然后单击<guimenu>下一步</guimenu>继续下一个安装步骤。
   </para>
  </sect2>

  <sect2 xml:id="sec-slem-registration">
   <title>注册</title>

<informalfigure>
    <mediaobject>
     <imageobject role="fo">
      <imagedata os="slemicro" fileref="install_registration_slem.png" width="100%"/>
     </imageobject>
     <imageobject role="html">
      <imagedata os="slemicro" fileref="install_registration_slem.png" width="100%"/>
      </imageobject>
    </mediaobject>
   </informalfigure>

   <para>
    要获取技术支持和产品更新，您需要在 SUSE Customer Center 或本地注册服务器中注册并激活 <phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase>。
   </para>
   <variablelist>
    <varlistentry>
     <term><guimenu>通过 scc.suse.com 注册系统</guimenu></term>
     <listitem>
      <para>
       要在 SUSE Customer Center 中注册，请输入与您的 SCC 帐户关联的<guimenu>电子邮件地址</guimenu>，以及 <phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase> 的<guimenu>注册代码</guimenu>。单击<guimenu>下一步</guimenu>继续。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><guimenu>通过本地 RMT 服务器注册系统</guimenu></term>
     <listitem>
      <para>
       如果您的组织提供了本地注册服务器，您也可以在该服务器中注册。激活<guimenu>通过本地 RMT 服务器注册系统</guimenu>，然后从下拉框中选择 URL，或者键入地址。单击<guimenu>下一步</guimenu>继续。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><guimenu>跳过注册</guimenu></term>
     <listitem>
      <para>
       如果您要跳过注册，请单击<guimenu>跳过注册</guimenu>。单击<guimenu>确定</guimenu>接受警告，然后单击<guimenu>下一步</guimenu>继续。
      </para>
      <important>
       <title>跳过注册</title>
       <para>
        您的系统必须注册才能检索更新以及有资格获享支持。您可以稍后在安装后注册。
       </para>
      </important>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    完成注册后，单击<guimenu>下一步</guimenu>。
   </para>
  </sect2>

  <sect2 xml:id="sec-slem-ntp">
   <title>NTP 服务器配置</title>

<informalfigure>
    <mediaobject>
     <imageobject role="fo">
      <imagedata os="slemicro" fileref="install_ntp_slem.png" width="100%"/>
     </imageobject>
     <imageobject role="html">
      <imagedata os="slemicro" fileref="install_ntp_slem.png" width="100%"/>
      </imageobject>
    </mediaobject>
   </informalfigure>
   <para>
    为了确保您系统上的时间正确同步，请至少配置一台 NTP 服务器。
   </para>
  </sect2>

  <sect2 xml:id="sec-slem-root-creation">
   <title><systemitem class="username">root</systemitem> 的身份验证</title>
<informalfigure>
    <mediaobject>
     <imageobject role="fo">
      <imagedata os="slemicro" fileref="install_authentication_slem.png" width="100%"/>
     </imageobject>
     <imageobject role="html">
      <imagedata os="slemicro" fileref="install_authentication_slem.png" width="100%"/>
      </imageobject>
    </mediaobject>
   </informalfigure>

   <para>
    为 <systemitem class="username">root</systemitem> 配置至少包含 5 个字符的强口令，口令由大小写字母和数字组成。口令最长为 72 个字符，区分大小写。</para>
    <para>您可以通过单击<guimenu>浏览</guimenu>并选择 SSH 公共密钥来导入已存在的 SSH 密钥。
   </para>
   <para>
    单击<guimenu>下一步</guimenu>继续下一个安装步骤。
   </para>
  </sect2>

  <sect2 xml:id="sec-slem-installation-settings">
   <title>安装设置</title>
<informalfigure>
    <mediaobject>
     <imageobject role="fo">
      <imagedata os="slemicro" fileref="install_settings_slem.png" width="100%"/>
     </imageobject>
     <imageobject role="html">
      <imagedata os="slemicro" fileref="install_settings_slem.png" width="100%"/>
      </imageobject>
    </mediaobject>
   </informalfigure>

   <para>
    最后一个安装步骤会提供安装设置的摘要。请查看设置，并根据需要进行更改。要更改设置，请单击选项后面的按钮，或单击设置标题以查看更多选项。
   </para>
   <variablelist>
    <varlistentry>
     <term><guimenu>分区</guimenu></term>
     <listitem>
      <para>
       要修改分区，可以使用<guimenu>专家分区程序</guimenu>。要加密磁盘或启用逻辑卷管理，请单击<guimenu>引导性配置</guimenu>，然后填写磁盘解密口令。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><guimenu>软件</guimenu></term>
     <listitem>
      <para>
       单击<guimenu>软件</guimenu>会打开<guimenu>软件选择和系统任务</guimenu>屏幕，您可在此处选择或取消选择某些模式以更改软件选择。每个模式都包含特定功能所需的数个软件包。要查看和管理这些软件包，请单击<guimenu>细节</guimenu>。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><guimenu>时区</guimenu></term>
     <listitem>
      <para>
       默认会使用安装过程前面的步骤中提供的 NTP 服务器来同步时间，但您可以选择区域和时区。如果您要手动设置时间和日期，请单击<guimenu>其他设置</guimenu>按钮并选择<guimenu>手动</guimenu>。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><guimenu>网络配置</guimenu></term>
     <listitem>
      <para>
       显示当前网络配置。单击<guimenu>网络配置</guimenu>可更改设置。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><guimenu>引导</guimenu></term>
     <listitem>
      <para>
       此部分显示引导加载器配置。建议您仅在确实需要时才更改默认设置。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><guimenu>Kdump</guimenu></term>
     <listitem>
      <para>
       如果发生内核崩溃，Kdump 可将内存映像（<quote>内核转储</quote>）保存到文件系统中。如此，您便可以通过调试转储文件来查找崩溃原因。Kdump 已预先配置好，默认处于启用状态。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><guimenu>默认 systemd 目标</guimenu></term>
     <listitem>
      <para>
       只提供文本模式。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><guimenu>系统</guimenu></term>
     <listitem>
      <para>
       单击<guimenu>系统</guimenu>可查看详细的硬件信息。在随即显示的屏幕中，还可以更改<guimenu>内核设置</guimenu>。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><guimenu>安全性</guimenu></term>
     <listitem>
      <para>
       <guimenu>CPU 缓解措施</guimenu>是指为防御 CPU 边信道攻击而部署的软件缓解措施对应的内核引导命令行参数。单击高亮显示的条目可选择其他选项。
      </para>
      <para>
       防火墙默认处于禁用状态。单击<guimenu>启用</guimenu>可更改该默认设置。
      </para>
      <para>
       SSH 服务默认处于启用状态。单击<guimenu>禁用</guimenu>可更改该设置。请注意，如果禁用 SSH 服务，您将无法远程登录系统。SSH 端口 (22) 默认已打开。
      </para>
      <para>
       默认的 SELinux 选项为<guimenu>已禁用</guimenu>。您可以单击<guimenu>安全性</guimenu>并在<guimenu>模式</guimenu>菜单中选择其他选项，以更改该值。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    如果您已查看安装设置，则可以单击<guimenu>安装</guimenu>，然后确认安装以继续安装。
   </para>
  </sect2>
 </sect1>
 <sect1 xml:id="sec-slem-autoyast">
  <title>使用 AutoYaST 进行无人照管的安装</title>

  <para>
   可以使用 AutoYaST 来安装 <phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase>。您需要手动创建一个 XML 控制文件，该文件也称为配置文件。然后 AutoYaST 便会根据该配置文件中的指示安装 SLE Micro。有关细节，请参见<xref linkend="book-autoyast"/>。
  </para>
  <important>
  <para>AutoYaST 配置文件中的一些资源和属性默认在无人照管安装的第二阶段应用，但该第二阶段不适用于 <phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase>。因此，为了应用所有资源和属性，您需要在 AutoYaST 配置文件中禁用第二阶段： </para>
    <screen>
  &lt;second_stage config:type="boolean"&gt;false&lt;/second_stage&gt;
  </screen>
  <para>如此，AutoYaST 便会在第一阶段应用所有资源和属性，而不论它们是否默认在第二阶段应用。</para>
  </important>
 </sect1>
 <sect1 xml:id="sec-slem-image-deployment">
  <title>Raw 映像部署</title>

  <para>
   <phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase> 提供可直接部署到设备储存（内存卡、USB 闪存盘或硬盘）的 raw 映像。映像可部署到的设备类型选项取决于您的特定硬件 — 请遵照供应商文档选择。
  </para>

  
<para>
要初始配置部署的映像，您需要按照<xref linkend="pro-preparing-configuration-device"/>中所述准备配置数据，并且需要将配置数据复制到某个设备（例如 USB 磁盘）上。设备需要在首次引导时连接到运行 SLE Micro 的主机。您可以按以下过程所述准备用于部署的设置： 
</para>
  <procedure>
   <title>准备 raw 磁盘映像</title>
   <step>
    <para>
     下载 raw 映像并将其解压缩：
    </para>
<screen><prompt>tux &gt; </prompt>xz -d &lt;downloaded_image.raw.xz&gt;</screen>
   </step>
   <step>
    <para>
     将解压缩后的映像复制到将运行 SLE Micro 的设备：
    </para>
<screen><prompt>tux &gt; </prompt>dd if=&lt;downloaded_image.raw&gt; of=/dev/sdX</screen>
   </step>
   </procedure>
   <para>下面的过程说明如何准备配置设备（通常是 USB 闪存盘）。</para>
   <procedure xml:id="pro-preparing-configuration-device">
   <title>准备配置设备</title>
   <step>
     <para>
      将磁盘格式化为 SLE Micro 支持的任何文件系统（FAT、Ext4 等）：
     </para>
<screen>
<prompt>tux &gt; </prompt>sudo mkfs.ext4 /dev/sdY
</screen>
    </step>
   <step>
     <para>
      将设备标签设置为 <literal>ignition</literal> 或 <literal>combustion</literal>。对于 Ext4 文件系统：
     </para>
<screen><prompt>tux &gt; </prompt>sudo e2label /dev/sdY ignition</screen>
    <para>
     您可以使用您的虚拟化系统或硬件支持的任何类型的配置储存媒体 — ISO 映像、USB 闪存盘等。 
    </para>
   </step>
   <step>
     <para>
      装入设备：
     </para>
<screen>
<prompt>tux &gt; </prompt>sudo mount /dev/sdY /mnt
</screen>
</step>
<step>
     <para>
      创建<xref linkend="sec-slem-ignition"/>或<xref linkend="sec-slem-combustion"/>中所述的目录结构，具体取决于使用的配置工具：
     </para>
<screen>
<prompt>tux &gt; </prompt>sudo mkdir -p /mnt/ignition/
</screen>
     <para>
      或：
     </para>
<screen>
<prompt>tux &gt; </prompt>sudo mkdir -p /mnt/combustion/
</screen>
    </step>
   <step>
    <para>
     在首次引导前，准备 <xref linkend="sec-slem-ignition" xrefstyle="template:Ignition"/> 或 <xref linkend="sec-slem-combustion" xrefstyle="template:Combustion"/> 将要使用的配置的所有元素。配置至少必须为 <systemitem class="username">root</systemitem> 提供一个口令，否则在首次引导后将无法访问系统。
    </para>
   </step>
   </procedure>
  
  <para>
     首次引导之后，您需要使用命令行工具 <command>SUSEConnect</command> 注册 SUSE Linux Enterprise Micro 实例。有关细节，请参见<xref linkend="sec-register-slem-system-suseconnect"/>。
    </para>

  <sect2 xml:id="sec-slem-ignition">
   <title>使用 Ignition 配置</title>
   <para>
    Ignition 会在系统首次引导时根据 <filename>config.ign</filename> 配置文件配置系统。<filename>config.ign</filename> 文件必须位于名为 <filename>ignition</filename> 的目录中。<filename>ignition</filename> 是根目录的子目录。根目录还包含要部署的 raw 映像。目录结构如下所示：
   </para>
<screen>
&lt;root directory&gt;
	- ignition
		- config.ign
	</screen>
   <para>
    <filename>config.ign</filename> 采用 JSON 格式。下面是一个极为简单的示例：
   </para>
<screen>
{
  "ignition": { "version": "3.1.0" },
  "passwd": {
    "users": [
      {
        "name": "root",
        "passwordHash": "O9h4s2UUtAtok"
      }
    ]
  }
}
</screen>
   <para>
    上面的示例将 <systemitem class="username">root</systemitem> 的口令设置为 <emphasis>password</emphasis>。要获取您自己的口令哈希，请使用以下命令：
   </para>
<screen>
<prompt role="root">root # </prompt> openssl passwd
</screen>

  </sect2>

  <sect2 xml:id="sec-slem-combustion">
   <title>使用 Combustion 配置</title>
   <para>
    Combustion 是 dracut 的一个极小的模块。您可以提供自己的脚本，Combustion 会在系统首次引导时运行该脚本。您可以使用 Combustion 添加文件、安装软件包、设置设备，以及重新对磁盘分区。您可以在外部储存上以外壳脚本的形式提供配置。该脚本在系统引导过程中于事务更新外壳中执行。如果该过程成功完成，系统将引导到新快照。
   </para>
   <para>
    要在引导时使用 Combustion，请创建一个名为 <filename>combustion</filename> 的目录作为根目录的子目录。在 <filename>combustion</filename> 目录中，放置一个名为 <filename>script</filename> 的文件，以及任何其他必要文件。目录结构如下所示：</para>
    <screen>
    &lt;root directory&gt;
	- combustion
		- script
		- other files
	</screen>
    <note>
    <title>在 QEMU 虚拟机上使用 Combustion</title>
    <para>Combustion 会在 <filename>opt/org.opensuse.combustion/script</filename> 中搜索 <filename>script</filename>。如果 <filename>script</filename> 存在，Combustion 将在设备上创建 <filename>combustion</filename> 目录，并将 <filename>script</filename> 复制到该目录。</para>
    <para>要将 <filename>script</filename> 传递到您的虚拟机，请使用以下 QEMU <literal>fw cfg</literal> 参数：</para>
    <screen>
    -fw_cfg name=opt/org.opensuse.combustion/script,file=/var/combustion-script
    </screen>
    </note>
    <para>您可以将 Combustion 与 Ignition 结合使用。在此情况下，请将您的设备标签设置为 <literal>ignition</literal>，创建根目录的 <filename>ignition</filename> 子目录，并将 <filename>config.ign</filename> 置于 <filename>ignition</filename> 目录中。目录结构如下所示：
   </para>
<screen>
&lt;root directory&gt;
	-combustion
		- script
		- other files
	- ignition 
		- config.ign
	</screen>
   <para>
    下面的 <filename>script</filename> 示例会设置 <systemitem class="username">root</systemitem> 口令、复制 SSH 密钥（SSH 密钥必须位于 <filename>combustion</filename> 目录中），并安装简化了功能的 <emphasis>Vim</emphasis> 编辑器。
   </para>
<screen>
#!/bin/bash
# combustion: network
# Redirect output to the console
exec &gt; &gt;(exec tee -a /dev/tty0) 2&gt;&amp;1
# Set a password for root, generate the hash with "openssl passwd -6"
echo 'root:$5$.wn2BZHlEJ5R3B1C$TAHEchlU.h2tvfOpOki54NaHpGYKwdNhjaBuSpDotD7' | chpasswd -e
# Add a public ssh key and enable sshd
mkdir -pm700 /root/.ssh/
cat id_rsa_new.pub &gt;&gt; /root/.ssh/authorized_keys
systemctl enable sshd.service
# Install vim-small
zypper --non-interactive install vim-small
# Leave a marker
echo "Configured with combustion" &gt; /etc/issue.d/combustion
</screen>
<note>
   <para>
    <literal># combustion: network</literal> 语句告知 Combustion 必须在执行脚本之前配置网络。Combustion 使用 <literal>initrd</literal> 网络配置 — 默认使用 DHCP。
   </para>
   </note>
  </sect2>

 

  <sect2 xml:id="sec-register-slem-system-suseconnect">
   <title>使用 SUSEConnect 注册</title>
   <para>
    可以使用 <command>SUSEConnect</command> 从命令行注册系统。如果所需的信息超出了本节的范畴，请使用 <command>man 8 SUSEConnect</command> 查看内联文档。
   </para>
   <procedure>
    <title>使用 SUSEConnect 注册产品</title>
    <step>
     <para>
      要在 SUSE Customer Center 中注册 <phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase>，请按如下所示运行 <command>SUSEConnect</command>：
     </para>
<screen><prompt>tux &gt; </prompt>sudo SUSEConnect -r <replaceable>REGISTRATION_CODE</replaceable> -e <replaceable>EMAIL_ADDRESS</replaceable></screen>
     <para>
      要在本地注册服务器中注册，另请提供该服务器的 URL：
     </para>
<screen><prompt>tux &gt; </prompt>sudo SUSEConnect -r <replaceable>REGISTRATION_CODE</replaceable> -e <replaceable>EMAIL_ADDRESS</replaceable> \
--url "https://suse_register.example.com/"</screen>
     <para>
      将 <replaceable>REGISTRATION_CODE</replaceable> 替换为与 <phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase> 副本一同收到的注册码。将 <replaceable>EMAIL_ADDRESS</replaceable> 替换为与您或您的组织管理订阅时所用的 SUSE 帐户关联的电子邮件地址。
     </para>
    </step>
    <step>
     <para>
      <phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase> 现已注册完毕。
     </para>
    </step>
   </procedure>
  </sect2>
 </sect1>
 <xi:include href="common_copyright_quick.xml"/>
 <xi:include href="common_gfdl1.2_i.xml"/>
</article>
