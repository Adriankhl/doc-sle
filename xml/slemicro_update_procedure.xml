<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter
[
  <!ENTITY % entities SYSTEM "generic-entities.ent">
    %entities;
]>
<chapter version="5.0" xml:id="cha-upgrade-procedure-slemicro"
  xmlns="http://docbook.org/ns/docbook"
  xmlns:xi="http://www.w3.org/2001/XInclude"
  xmlns:xlink="http://www.w3.org/1999/xlink">
 <title>Upgrading the system</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker></dm:bugtracker>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
  <abstract>
   <para>
    SUSE offers a command-line tool to upgrade a running system to a new
    version. The tool provides support for “rollback” to an older release. This
    chapter explains how to upgrade your system step by step.
   </para>
  </abstract>
 </info>
 <para>
  &suse; releases new version of &slema; at regular intervals. To make it easy
  for customers to migrate to a new minor version and minimize downtime, &suse;
  supports migrating online while the system is running.
 </para>
 <para>
  &slema; uses <emphasis>transactional updates</emphasis> to upgrade from one
  version to the next. This has the following advantages:
 </para>
 <itemizedlist>
  <listitem>
   <para>
    The system is always in a defined state until the first RPM is updated.
   </para>
  </listitem>
  <listitem>
   <para>
    Canceling is possible until the first RPM is updated.
   </para>
  </listitem>
  <listitem>
   <para>
    Simple recovery if there is an error.
   </para>
  </listitem>
  <listitem>
   <para>
    It is possible to do a <quote>rollback</quote> via system tools&mdash;no
    backup or restore needed.
   </para>
  </listitem>
  <listitem>
   <para>
    Use of all active repositories.
   </para>
  </listitem>
 </itemizedlist>
 <sect1 xml:id="sec-run-transactional-update">
  <title>Upgrading to a new release</title>

  <important>
   <title>Upgrading to a new release and <command>wicked</command></title>
   <para>
    &slema; 5.3 introduced Network Manager as the default tool to manage
    networking. However, when you perform an upgrade from previous releases,
    the default network framework remains <command>wicked</command>. Automated
    migration from <command>wicked</command> to &nm; or the migration of the
    <command>wicked</command> configuration is not supported. However, you can
    switch from <command>wicked</command> to &nm; as described in
    <xref linkend="proc-wicked-switch"/>.
   </para>
  </important>

  <note>
   <title>&suse; Linux Enterprise Live Patching</title>
   <para>
    If you have the &suse; Linux Enterprise Live Patching extension enabled,
    the extension is not affected during the upgrade procedure.
   </para>
  </note>

  <para>
   If your system is registered with the &scc;, make sure to have an Internet
   connection during the following procedure:
  </para>

  <procedure xml:id="proc-upgrade-registered">
   <title>Upgrade to a newer version</title>
   <step>
    <para>
     The upgrade procedure is performed by calling the
     <command>transactional-update</command>:
    </para>
<screen>
   transactional-update migration
   </screen>
   </step>
   <step>
    <para>
     A new snapshot is created.
    </para>
   </step>
   <step>
    <para>
     Current repositories are refreshed.
    </para>
   </step>
   <step>
    <para>
     A list of available migration targets is displayed. Enter a number.
    </para>
   </step>
   <step>
    <para>
     A list of packages to be installed or updated is displayed. Press
     <literal>y</literal> to continue with the upgrade procedure.
    </para>
   </step>
   <step>
    <para>
     To complete the upgrade, reboot your system and boot into the target
     version.
    </para>
   </step>
  </procedure>

  <para>
   If your system is not registered, proceed as follows:
  </para>

  <procedure xml:id="proc-unregistered-upgrade">
   <title>Upgrading an unregistered system</title>
   <step>
    <para>
     Change the URL of the update repositories to point to the &productnumber;.
    </para>
   </step>
   <step>
    <para>
     Run the following command:
    </para>
<screen>&prompt.root;transactional-update dup</screen>
   </step>
  </procedure>

  <para>
   After you complete the upgrade procedure, if needed, you can to switch from
   <command>wicked</command> to &nm; without performing a fresh installation.
   To do so, proceed as follows:
  </para>

  <procedure xml:id="proc-wicked-switch">
   <title>Switching from <command>wicked</command> to &nm;</title>
   <step>
    <para>
     Run the following command to create a new snapshot where you perform all
     other changes to the system:
    </para>
<screen>&prompt.root;transactional-update shell</screen>
   </step>
   <step>
    <para>
     Install &nm;:
    </para>
<screen>&prompt.root;zypper in NetworkManager</screen>
   </step>
   <step>
    <para>
     Remove <command>wicked</command> from the system:
    </para>
<screen>&prompt.root;zypper rm wicked-service</screen>
   </step>
   <step>
    <para>
     Enable the &nm; service:
    </para>
<screen>&prompt.root;systemctl enable NetworkManager</screen>
   </step>
   <step>
    <para>
     If needed, configure the service according to your needs.
    </para>
   </step>
   <step>
    <para>
     Close the <command>transactonal-update</command> shell:
    </para>
<screen>&prompt.root;exit</screen>
   </step>
   <step>
    <para>
     Reboot your system to switch to the new snapshot.
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 xml:id="sec-upgrade-cancel-slemicro">
  <title>Reverting the migration process</title>

  <para>
   If a new release does not work for you, &slema; supports reverting the
   system to the state before the migration process was started by using the
   <command>transactional-update rollback</command> command.
  </para>

  <para>
   The detailed procedure for a system rollback is described in
   <xref linkend="sec-rollback-procedure"/>.
  </para>
 </sect1>
</chapter>
