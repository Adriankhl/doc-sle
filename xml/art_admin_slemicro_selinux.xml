<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet href="urn:x-suse:xslt:profiling:docbook50-profile.xsl"
                 type="text/xml"
                 title="Profiling step"?>
<!DOCTYPE article
[
  <!ENTITY % entities SYSTEM "generic-entities.ent">
    %entities;
]>
<article xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0" xml:id="article-selinux" xml:lang="en">
  <title>&slema; security</title>
  <section xml:id="sec-introduction-selinux">
    <title>Introduction to SELinux</title>
    <para>
   SELinux was developed as an additional Linux security solution that uses
   the security framework in the Linux kernel. The purpose was to allow for
   a more granular security policy that goes beyond the standard 
   Discretionary Access Controls (DAC), the traditional file permissions
   of owner/group/world, and read/write/execute.
  </para>

  <para>
   SELinux uses labels attached to objects (for example, files, binaries,
   and network sockets) and uses them to determine privilege boundaries, 
   thereby building up a level of confinement that can span more than a 
   process, or even the whole system.
  </para>

  <para>
   SELinux was developed in accordance with some certification standards
   like Common Criteria and FIPS 140.
  </para>


    <section xml:id="sec-terminology">
      <title>Terminology</title>
      <para>
        The following terms are used in this document:
      </para>
      <variablelist>
        <title>Terminology</title>
        <varlistentry>
          <term>context</term>
          <listitem>
            <para>is a set of information assigned to a process or a file. It consists of identity, role, type and level.</para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>domain</term>
          <listitem>
            <para>is a type assigned to a process.</para>
          </listitem>
        </varlistentry>        
       <!--
        <varlistentry>
          <term>entrypoint</term>
          <listitem>
            <para></para>
          </listitem>
        </varlistentry> 
      -->
        <varlistentry>
          <term>identity</term>
          <listitem>
            <para>a user indetity authorized for a specific set of roles. Each Linux user is mapped onto a SELinux user identity.</para>
          </listitem>
        </varlistentry> 
        <varlistentry>
          <term>label</term>
          <listitem>
            <para></para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>mode</term>
          <listitem>
            <para>is a mode of SELinux operation. For details refer to <xref linkend="sec-selinux-modes"/></para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>policy</term>
          <listitem>
            <para>is a set of rules that defines what actions can be performed on types by domains. For details refer to <xref linkend="sec-policy-overview"/>.</para>
          </listitem>
        </varlistentry> 
        <varlistentry>
          <term>role</term>
          <listitem>
            <para>a role a user can have, for example, a system administrator or a database administrator. By convention, the role name is suffixed with <literal>_r</literal>, for example: <literal>system_r</literal>.</para>
          </listitem>
        </varlistentry> 
        <!-- <varlistentry>
          <term>transition</term>
          <listitem>
            <para>there are two types of transitions:</para>
            <itemizedlist>
            <listitem>
              <para><emphasis>domain transition</emphasis></para>
            </listitem>
            <listitem>
              <para><emphasis>file type transition</emphasis></para>
            </listitem>
          </itemizedlist>
            </listitem>
          </varlistentry>  
          -->     
        <varlistentry>
          <term>type</term>
          <listitem>
            <para>conveys information how particular files and processes can interact. A process is assigned files with a concrete SELinux type and it cannot acces files outside of this type.</para>
          </listitem>
        </varlistentry>        
      </variablelist>
    </section>
    <section xml:id="sec-selinux-modes">
      <title>SELinux modes</title>
      <para>
        SELinux can run in one of three modes: <literal>disabled</literal>, <literal>permissive</literal>, or <literal>enforcing</literal>.
      </para>
      <para>
        Using the <literal>disabled</literal> means that no rules from the SELinux policy are applied and your system is not protected. Therefore, the <literal>disabled</literal> mode is not recommended.
      </para>
      <para>
        In the <literal>permissive</literal> mode, SELinux is active, the security policy is loaded, the file system is labelled and access denial entries are logged. Though the policy is not enforced and thus no access is actually denied.
      </para>
      <para>
        In the <literal>enforced</literal> mode, the security policy is applied. Each access that is not explicitly allowed by the policy is denied.
      </para>
      <para>
        For details how to change SELinux mode, refer to <xref linkend="sec-switching-modes"/>.
      </para>      
    </section>
<section xml:id="sec-policy-overview">
    <title>SELinux policy overview</title>
    <para>
   The policy is the key component in SELinux.
    Your SELinux policy defines rules that specify which objects can access which files, directories,
   ports, and processes on a system. To do this, a security context is
   defined for all of these. 
  </para>
  <para>
    An SELinux policy contains a huge number of rules. To make it more manageable, policies are often split into modules. This allows administrator to switch protection on or off for different parts of the system.
  </para>
  <para>
    When compiling the policy for your system, you will have a choice to either work with a modular policy, or a monolithic policy, where one huge policy is used to protect everything on your system. It is strongly recommended to use a modular policy and not a monolithic policy. Modular policies are much easier to manage.
  </para>
  </section>

  </section>

  <section xml:id="sec-getting-selinux">
    <title>Getting SELinux</title>
    <para>
      SELinux is installed by default when installing by &yast; or is part of the pre-built images. In system installed manually by &yast;, SELinux is in the <literal>disabled</literal> mode by default and the file system is not labelled. If you deployed your system using the pre-built images, the SELinux mode is <literal>permissive</literal> and the file system is labelled.
      </para>
      <para>
        To set the SELinux mode to <literal>enforcing</literal> and configure your system properly for using SELinux, run the following command: 
    </para>
    <screen>&prompt.root;transactional-update setup-selinux</screen>
    <para>
      Reboot your system after the command completes. The command installs the SELinux policy if it is not installed, sets the SELinux mode and rebuilts <literal>initrd</literal>.
    </para>
  </section>

  <section xml:id="sec-switching-modes">
    <title>Changing SELinux modes</title>
    <para>
      You can switch between the <literal>enforcing</literal> and <literal>permissive</literal> modes by using the <command>setenforce</command> command. Or you can switch between all SELinux mode by editing the <filename>/etc/selinux/config</filename> configuration file. Changes performed by the <command>setenforce</command> command are valid only until the next reboot. For permanent changes of the SELinux mode, edit the <filename>/etc/selinux/config</filename> configuration file.
    </para>
    
<para>  
  The <command>setenforce</command> command has the following syntax:
  </para>
  <screen>&prompt.root;setenforce <replaceable>MODE_ID</replaceable></screen>
  <para>
    where <replaceable>MODE_ID</replaceable> is 0 for the <literal>permissive</literal> mode or 1 for the <literal>enforced</literal> mode. 
  </para>
  <para>
    To verify the mode, run the following command.
  </para>
  <screen>&prompt.root;getenforce</screen>
  <para>
    The command should return <literal>permissive</literal> or <literal>enforced</literal>, depending on the provided <replaceable>MODE_ID</replaceable>.
  </para>


  <para>
To change the SELiux mode permanently, in the file <filename>/etc/selinux/config</filename> change the value of <literal>SELINUX</literal> to <literal>disabled</literal>, or <literal>permissive</literal>, or <literal>enforced</literal> as follows:
    </para>
    <screen>SELINUX=disabled</screen>
    <para>
      The changes in the file are applied after next reboot.
    </para>
    <note>
      <title>Relabelling your system after switching from the <literal>disabled</literal> mode</title>
      <para>
        If you disable SELinux on your system and then enable it later, make sure that you relabel your system. When SELinux is disabled and you perform changes to your file system, the changes are not reflected in the context any more (for example, new files do not have any context), therefore you need to relabel your system by using the <command>restorecon</command> command, using the <literal>autorelabel</literal> boot parameter or by creating a file that will trigger relabelling on the next boot. To create the file, do the folowing:
      </para>
      <screen>&prompt.root;touch /etc/selinux/.autorelabel</screen> 
      <para>After reboot, the file is replaced with another flag file: <filename>/etc/selinux/.relabelled</filename>. </para>     
    </note>
  </section>


  <section xml:id="sec-managing-modes">
    <title>Commands for managing SELinux</title>
    <para>
      In the default deployment, regardless of the deployment method, some of the commands for managing SELinux are not installed. To install the commands described further, run the following command:
    </para>
    <screen>&prompt.root;transactional-update pkg install policycoreutils-python-utils</screen>

    <para>
      After the successfull installation, you will be able to use the following commands to manage your system:
    </para>

    <variablelist>
      <title>SELinux commands</title>
      <varlistentry>
        <term><command>getenforce</command></term>
        <listitem>
          <para>displays the current SELinux mode</para>
          <screen></screen>
        </listitem> 
      </varlistentry>
      <varlistentry>
        <term><command>ls -Z <replaceable>PATH</replaceable></command></term>
        <listitem>
          <para>
            shows security context of all files in the specified <replaceable>PATH</replaceable>, for example:
          </para>
          <screen>&prompt.root;ls -Z /
system_u:object_r:bin_t:s0 bin
system_u:object_r:boot_t:s0 boot
system_u:object_r:device_t:s0 dev
system_u:object_r:etc_t:s0  etc
system_u:object_r:home_root_t:s0 home
system_u:object_r:lib_t:s0 lib
system_u:object_r:lib_t:s0 lib64
system_u:object_r:mnt_t:s0 mnt
system_u:object_r:usr_t:s0 opt
system_u:object_r:proc_t:s0 proc
system_u:object_r:default_t:s0 root
system_u:object_r:var_run_t:s0 run
system_u:object_r:bin_t:s0 sbin
system_u:object_r:var_t:s0 srv
system_u:object_r:sysfs_t:s0 sys
system_u:object_r:tmp_t:s0 tmp
system_u:object_r:usr_t:s0 usr
system_u:object_r:var_t:s0 var
          </screen>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term><command>restorecon</command></term>
        <listitem>
          <para>restores a file context to the default value (as stored in the SELinux policy)</para>
        </listitem> 
      </varlistentry>
      <varlistentry>
        <term><command>seinfo</command></term>
        <listitem>
          <para>enables you to query components of a SELinux policy</para>
        </listitem> 
      </varlistentry>
      <varlistentry>
        <term><command>semanage</command></term>
        <listitem>
          <para>enables you to adjust context, ocnfigure certain elements of SELinux policy</para>
        </listitem> 
      </varlistentry>
      <varlistentry>
        <term><command>setenforce</command></term>
        <listitem>
          <para>enables you to temporarily set a SELinux mode.</para>
        </listitem> 
      </varlistentry>
    </variablelist> 

    <note>
      <title>The <literal>Z</literal> option available to other commands</title>
      <para>
        The <literal>Z</literal> option is available also to other commands, for example: <command>cp</command> and <command>id</command>.
      </para>
    </note>   
  </section>  
</article>